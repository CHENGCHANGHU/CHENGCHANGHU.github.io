!function(){"use strict";const e={type:"boolean",value:!1};function n(n){const t={"=":1,"||":2,"&&":3,"<":7,">":7,"<=":7,">=":7,"==":7,"!=":7,"+":10,"-":10,"*":20,"/":20,"%":20};return function(){console.log("[Parser parseTopLevel]");const e=[];for(;!n.eof();)e.push(p()),n.eof()||a(";");return{type:"program",program:e}}();function r(e){const t=n.peek();return t&&"puctuaton"==t.type&&(!e||t.value==e)&&t}function o(e){const t=n.peek();return t&&"keyword"==t.type&&(!e||t.value==e)&&t}function a(e){r(e)?n.next():n.croak('Expecting punctuation: "'+e+'"')}function i(e){o(e)?n.next():n.croak('Expecting keyword: "'+e+'"')}function s(e,r){console.log("[Parser maybeBinary]",n.peek());const o=function(e){const t=n.peek();return t&&"operation"==t.type&&(!e||t.value===e)&&t}();if(o){const a=t[o.value];if(a>r)return n.next(),s({type:"="===o.value?"assign":"binary",operator:o.value,precedence:a,leftValue:e,rightValue:s(d(),a)},r)}return e}function l(e,t,o,i){var s=[],l=!0;for(a(e);!n.eof()&&!r(t)&&(l?l=!1:a(o),!r(t));)s.push(i());return a(t),s}function c(){const e=n.next();return"variable"!==e.type&&n.croak("Expecting variable name"),e.value}function u(e){return console.log("[Parser maybeCall]"),e=e(),r("(")?{type:"call",functionName:e,arguments:l("(",")",",",p)}:e}function d(){return console.log("[Parser parseAtom]",n.peek()),u((function(){if(r("(")){n.next();const e=p();return a(")"),e}if(r("{"))return function(){const n=l("{","}",";",p);return 0==n.length?e:1==n.length?n[0]:{type:"program",program:n}}();if(o("if"))return function(){i("if");const e=p();r("{")||i("then");const t={type:"if",condition:e,then:p()};return o("else")&&(n.next(),t.else=p()),t}();if(o("true")||o("false"))return{type:"boolean",value:"true"===n.next().value};if(o("lambda")||o("Î»"))return n.next(),{type:"lambda",parameters:l("(",")",",",c),body:p()};const t=n.next();if(["variable","number","string"].includes(t.type))return t;console.log("[Parser unexpected]"),n.croak("Unexpected token: "+JSON.stringify(n.peek()))}))}function p(){return console.log("[Parser parseExpression]"),u((function(){return s(d(),0)}))}}class t{constructor(e=null){this.variables=Object.create(e?e.variables:{}),this.parent=e}extend(){return new t(this)}lookup(e){let n=this;for(;n;){if(Object.prototype.hasOwnProperty.call(n.variables,e))return n;n=n.parent}return null}get(e){if(e in this.variables)return this.variables[e];throw new Error("Undefined variable "+e)}set(e,n){const t=this.lookup(e);if(!t&&this.parent)throw new Error("Undefined variable "+e);return(t||this).variables[e]=n}def(e,n){return this.variables[e]=n}}function r(e,n){switch(e.type){case"number":case"string":case"boolean":return e.value;case"variable":return n.get(e.value);case"assign":if("variable"!=e.leftValue.type)throw new Error("Cannot assign to "+JSON.stringify(e.leftValue));return n.set(e.leftValue.value,r(e.rightValue,n));case"binary":return function(e,n,t){function r(e){if("number"!=typeof e)throw new Error("Expected number but got "+e);return e}function o(e){if(0===r(e))throw new Error("Divide by zero");return e}switch(e){case"+":return r(n)+r(t);case"-":return r(n)-r(t);case"*":return r(n)*r(t);case"/":return r(n)/o(t);case"%":return r(n)%o(t);case"&&":return!1!==n&&t;case"||":return!1!==n?n:t;case"<":return r(n)<r(t);case">":return r(n)>r(t);case"<=":return r(n)<=r(t);case">=":return r(n)>=r(t);case"==":return n===t;case"!=":return n!==t}throw new Error("Can't apply operator "+e)}(e.operator,r(e.leftValue,n),r(e.rightValue,n));case"lambda":return function(e,n){return function(...t){const o=e.extend();return n.parameters.forEach(((e,n)=>{o.def(e,t[n])})),r(n.body,o)}}(n,e);case"if":return!1!==r(e.condition,n)?r(e.then,n):!!e.else&&r(e.else,n);case"program":let t=!1;return e.program.forEach((e=>{t=r(e,n)})),t;case"call":return r(e.functionName,n).apply(null,e.arguments.map((e=>r(e,n))));default:throw new Error("I don't know how to evaluate "+e.type)}}class o extends HTMLElement{constructor(){super();const e=document.getElementById("e-button-template");this.attachShadow({mode:"open"}).appendChild(e.content.cloneNode(!0))}}function a(e){if(!e)return;if(e instanceof HTMLElement)return e;if(Array.isArray(e))return e.map((e=>a(e)));const{tag:n,text:t,html:r,children:o,attributes:i,events:s}=e;if(!n)return document.createElement("template");const l=document.createElement(n);return r&&(l.innerHTML=r),(t||0===t||""===t)&&(l.innerText=t),i&&Object.keys(i).forEach((e=>{"classes"===e&&Array.isArray(i[e])?l.className=i[e].join(" "):l.setAttribute("classes"===e?"class":e,i[e])})),s&&Object.keys(s).forEach((n=>{l.addEventListener(n,s[n].bind(e))})),o&&l.append(...o.filter(Boolean).map(a)),l}document.body.innerHTML+='<template id="e-button-template">\r\n  <style>\r\n    * {\r\n      margin: 0;\r\n      padding: 0;\r\n      color: #343434;\r\n      font-size: 12px;\r\n    }\r\n    .button-box {\r\n      /* background-color: red; */\r\n      padding: 4px 8px;\r\n      box-sizing: border-box;\r\n      border-width: 0px;\r\n      border-radius: 4px;\r\n      cursor: pointer;\r\n      background-color: rgb(3, 145, 98);\r\n      color: #fff;\r\n    }\r\n    .button-box:hover {\r\n      background-color: rgb(2, 129, 86);\r\n    }\r\n    .button-box:active {\r\n      background-color: rgb(1, 107, 72);\r\n    }\r\n    /* .button-box:focus {\r\n      outline: 2px solid rgb(94, 0, 0);\r\n    } */\r\n    .button-container {\r\n      color: #fff;\r\n    }\r\n  </style>\r\n  <button class="button-box">\r\n    <slot class="button-container"></slot>\r\n  </button>\r\n</template>',customElements.define("e-button",o);class i extends HTMLElement{tabs=[];activeTab="";constructor(){super(),this.attachShadow({mode:"open"}).appendChild(document.getElementById("e-tab-template").content.cloneNode(!0));const e=this.shadowRoot.querySelector(".e-tab-box"),n=[].slice.apply(e.querySelector(".e-tab-body-box").children)[0].assignedNodes();this.tabs=n.map((e=>{if(e.attributes&&e.attributes.getNamedItem("label")&&e.attributes.getNamedItem("name")){e.style.display="none";const n=e.attributes.getNamedItem("label").value,t=e.attributes.getNamedItem("name").value;return{label:n,name:t,display:getComputedStyle(e,null).display,el:e,header:a({tag:"div",text:n,attributes:{classes:["e-tab-header-item"],name:t},events:{click:e=>{this.handleClickTabHeader(e,t)}}})}}e.remove()})).filter(Boolean),this.activeTab=this.tabs[0].name,this.tabs[0].header.classList.add("e-tab-header-item-active"),this.tabs[0].el.style.display="",e.insertBefore(a({tag:"div",attributes:{classes:["e-tab-header-box"]},children:this.tabs.map((e=>e.header))}),e.firstChild)}handleClickTabHeader(e,n){const t=this.tabs.find((e=>e.name===this.activeTab));t.header.classList.remove("e-tab-header-item-active"),t.el.style.display="none",this.activeTab=n;const r=this.tabs.find((e=>e.name===this.activeTab));r.header.classList.add("e-tab-header-item-active"),r.el.style.display=""}}document.body.innerHTML+='<template id="e-tab-template">\r\n  <style>\r\n    .e-tab-box {\r\n      position: relative;\r\n      display: flex;\r\n      flex-flow: column;\r\n      align-items: stretch;\r\n    }\r\n    .e-tab-header-box {\r\n      display: flex;\r\n      flex-flow: row nowrap;\r\n      align-items: center;\r\n      width: 100%;\r\n    }\r\n    .e-tab-header-item {\r\n      margin-left: 4px;\r\n      padding: 4px 8px;\r\n      background-color: #aaa;\r\n      box-sizing: border-box;\r\n      border: 1px solid #999;\r\n      border-radius: 4px 4px 0 0;\r\n      cursor: pointer;\r\n      border-bottom-width: 0;\r\n      color: #fff;\r\n    }\r\n    .e-tab-header-item:first-child {\r\n      margin-left: 0;\r\n    }\r\n    .e-tab-header-item-active {\r\n      color: #343434;\r\n      background-color: #fff;\r\n    }\r\n    .e-tab-body-box {\r\n      padding: 4px 8px;\r\n      border: 1px solid #999;\r\n      border-radius: 0 0 4px 4px;\r\n      box-sizing: border-box;\r\n    }\r\n  </style>\r\n  <div class="e-tab-box">\r\n    <div class="e-tab-body-box">\r\n      <slot></slot>\r\n    </div>\r\n  </div>\r\n</template>',customElements.define("e-tab",i);class s extends HTMLElement{#e=null;#n=null;#t=null;constructor(){super(),this.#e=this.attachShadow({mode:"closed"}),this.#e.appendChild(document.getElementById("page-header").content.cloneNode(!0)),this.#n=this.#e.querySelector("#manuscript-logo-img"),this.#t=this.#e.querySelector("#manuscript-logo-text")}connectedCallback(){this.#n.addEventListener("click",this.#r),this.#t.addEventListener("click",this.#r)}#r(){const e=window.location.href;console.log(e),/manuscript/.test(e)?window.location.assign("/manuscript"):window.location.assign("/")}}document.getElementById("page-header")||(document.body.innerHTML+='<template id="page-header">\r\n  <style>\r\n    .page-header-box {\r\n      --logoSize: 36px;\r\n\r\n      position: sticky;\r\n      width: 100vw;\r\n      height: 48px;\r\n      top: 0;\r\n      display: flex;\r\n      flex-flow: row nowrap;\r\n      align-items: center;\r\n      padding: 0 8px;\r\n      font-size: 12px;\r\n      box-sizing: border-box;\r\n      z-index: 9999;\r\n      background-color: #32343d;\r\n      box-sizing: border-box;\r\n      box-shadow: 0px 5px 10px #afafaf;\r\n      color: #ffffff;\r\n    }\r\n\r\n    .manuscript-logo-box {\r\n      display: flex;\r\n      flex-flow: row nowrap;\r\n      align-items: center;\r\n    }\r\n\r\n    .manuscript-logo-img {\r\n      width: var(--logoSize);\r\n      transform: rotateY(180deg);\r\n      border: 1px solid #343434;\r\n      border-radius: 50%;\r\n      cursor: pointer;\r\n      background-color: #fff;\r\n    }\r\n\r\n    .manuscript-logo-text {\r\n      text-decoration: underline;\r\n      font-weight: bolder;\r\n      transition: all .3s ease-in-out;\r\n      cursor: pointer;\r\n      margin-left: 8px;\r\n    }\r\n\r\n    .manuscript-logo-text:hover {\r\n      color: rgb(3, 145, 98);\r\n    }\r\n\r\n    .page-title-box {\r\n      margin-left: 16px;\r\n      font-size: 16px;\r\n      font-weight: bolder;\r\n    }\r\n  </style>\r\n  <div class="page-header-box">\r\n    <div class="manuscript-logo-box">\r\n      <img\r\n        id="manuscript-logo-img"\r\n        class="manuscript-logo-img"\r\n        src="/assets/images/writing.a59d3288.png"\r\n        alt="tigercheng manuscript logo"\r\n      />\r\n      <div\r\n        id="manuscript-logo-text"\r\n        class="manuscript-logo-text"\r\n      >ALLX Manuscript (Loom)</div>\r\n    </div>\r\n    <div class="page-title-box">\r\n      <slot></slot>\r\n    </div>\r\n  </div>\r\n</template>'),customElements.define("page-header",s),window.onload=()=>{const e=document.getElementById("lambdaSourceCodeBox"),o=document.getElementById("lambdaRunResultBox"),a=document.getElementById("runBtn"),i=new t;i.def("print",(e=>{o.innerText+=e})),i.def("println",(e=>{o.innerText+=e+"\n"})),a.addEventListener("click",(()=>{if(!e.value)return;const t=function(e){let n=null;const t=["if","then","else","lambda","true","false"],r=["+","-","*","/","%","=","&","|","<",">","!"],o=[",",";","(",")","{","}","[","]"],a=[" ","\t","\n"];function i(e){return/\d/i.test(e)}function s(e){return/[_a-zA-Z]/i.test(e)}function l(e){return s(e)||/[0-9_]/.test(e)}function c(e){return r.includes(e)}function u(e){return a.includes(e)}function d(n){let t="";for(;!e.eof()&&n(e.peek());)t+=e.next();return t}function p(n){let t=!1,r="";for(e.next();!e.eof();){let o=e.next();if(t)r+=o,t=!1;else if("\\"===o)t=!0;else{if(o===n)break;r+=o}}return r}function f(){if(d(u),e.eof())return null;let n=e.peek();return"#"===n?(d((e=>"\n"!==e)),e.next(),f()):'"'===n?{type:"string",value:p('"')}:i(n)?function(){let e=!1,n=d((n=>"."===n?!e&&(e=!0,e):i(n)));return{type:"number",value:parseFloat(n)}}():s(n)?function(){let e=d(l);return{type:(n=e,t.includes(n)?"keyword":"variable"),value:e};var n}():(r=n,o.includes(r)?{type:"puctuaton",value:e.next()}:c(n)?{type:"operation",value:d(c)}:void e.croak(`Cannot handle character: ${n}`));var r}function b(){return n||(n=f())}return{next:function(){let e=n;return n=null,e||f()},peek:b,eof:function(){return null===b()},croak:e.croak}}(function(e){let n=0,t=1,r=0;function o(){return e.charAt(n)}return{next:function(){let o=e.charAt(n++);return"\n"===o?(t++,r=0):r++,o},peek:o,eof:function(){return""===o()},croak:function(e){throw new Error(`${e} (line: ${t}; col: ${r})`)}}}(e.value));console.log(t),r(n(t),i)})),window.addEventListener("keypress",(n=>{n.ctrlKey&&"Enter"===n.key&&document.activeElement===e&&a.click()}))}}();