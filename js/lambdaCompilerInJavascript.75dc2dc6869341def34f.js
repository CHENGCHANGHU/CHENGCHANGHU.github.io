!function(){"use strict";const e={type:"boolean",value:!1};function t(t){const n={"=":1,"||":2,"&&":3,"<":7,">":7,"<=":7,">=":7,"==":7,"!=":7,"+":10,"-":10,"*":20,"/":20,"%":20};return function(){console.log("[Parser parseTopLevel]");const e=[];for(;!t.eof();)e.push(p()),t.eof()||a(";");return{type:"program",program:e}}();function r(e){const n=t.peek();return n&&"puctuaton"==n.type&&(!e||n.value==e)&&n}function o(e){const n=t.peek();return n&&"keyword"==n.type&&(!e||n.value==e)&&n}function a(e){r(e)?t.next():t.croak('Expecting punctuation: "'+e+'"')}function i(e){o(e)?t.next():t.croak('Expecting keyword: "'+e+'"')}function l(e,r){console.log("[Parser maybeBinary]",t.peek());const o=function(e){const n=t.peek();return n&&"operation"==n.type&&(!e||n.value===e)&&n}();if(o){const a=n[o.value];if(a>r)return t.next(),l({type:"="===o.value?"assign":"binary",operator:o.value,precedence:a,leftValue:e,rightValue:l(d(),a)},r)}return e}function s(e,n,o,i){var l=[],s=!0;for(a(e);!t.eof()&&!r(n)&&(s?s=!1:a(o),!r(n));)l.push(i());return a(n),l}function c(){const e=t.next();return"variable"!==e.type&&t.croak("Expecting variable name"),e.value}function u(e){return console.log("[Parser maybeCall]"),e=e(),r("(")?{type:"call",functionName:e,arguments:s("(",")",",",p)}:e}function d(){return console.log("[Parser parseAtom]",t.peek()),u((function(){if(r("(")){t.next();const e=p();return a(")"),e}if(r("{"))return function(){const t=s("{","}",";",p);return 0==t.length?e:1==t.length?t[0]:{type:"program",program:t}}();if(o("if"))return function(){i("if");const e=p();r("{")||i("then");const n={type:"if",condition:e,then:p()};return o("else")&&(t.next(),n.else=p()),n}();if(o("true")||o("false"))return{type:"boolean",value:"true"===t.next().value};if(o("lambda")||o("Î»"))return t.next(),{type:"lambda",parameters:s("(",")",",",c),body:p()};const n=t.next();if(["variable","number","string"].includes(n.type))return n;console.log("[Parser unexpected]"),t.croak("Unexpected token: "+JSON.stringify(t.peek()))}))}function p(){return console.log("[Parser parseExpression]"),u((function(){return l(d(),0)}))}}class n{constructor(e=null){this.variables=Object.create(e?e.variables:{}),this.parent=e}extend(){return new n(this)}lookup(e){let t=this;for(;t;){if(Object.prototype.hasOwnProperty.call(t.variables,e))return t;t=t.parent}return null}get(e){if(e in this.variables)return this.variables[e];throw new Error("Undefined variable "+e)}set(e,t){const n=this.lookup(e);if(!n&&this.parent)throw new Error("Undefined variable "+e);return(n||this).variables[e]=t}def(e,t){return this.variables[e]=t}}function r(e,t){switch(e.type){case"number":case"string":case"boolean":return e.value;case"variable":return t.get(e.value);case"assign":if("variable"!=e.leftValue.type)throw new Error("Cannot assign to "+JSON.stringify(e.leftValue));return t.set(e.leftValue.value,r(e.rightValue,t));case"binary":return function(e,t,n){function r(e){if("number"!=typeof e)throw new Error("Expected number but got "+e);return e}function o(e){if(0===r(e))throw new Error("Divide by zero");return e}switch(e){case"+":return r(t)+r(n);case"-":return r(t)-r(n);case"*":return r(t)*r(n);case"/":return r(t)/o(n);case"%":return r(t)%o(n);case"&&":return!1!==t&&n;case"||":return!1!==t?t:n;case"<":return r(t)<r(n);case">":return r(t)>r(n);case"<=":return r(t)<=r(n);case">=":return r(t)>=r(n);case"==":return t===n;case"!=":return t!==n}throw new Error("Can't apply operator "+e)}(e.operator,r(e.leftValue,t),r(e.rightValue,t));case"lambda":return function(e,t){return function(...n){const o=e.extend();return t.parameters.forEach(((e,t)=>{o.def(e,n[t])})),r(t.body,o)}}(t,e);case"if":return!1!==r(e.condition,t)?r(e.then,t):!!e.else&&r(e.else,t);case"program":let n=!1;return e.program.forEach((e=>{n=r(e,t)})),n;case"call":return r(e.functionName,t).apply(null,e.arguments.map((e=>r(e,t))));default:throw new Error("I don't know how to evaluate "+e.type)}}class o extends HTMLElement{constructor(){super();const e=document.getElementById("e-button-template");this.attachShadow({mode:"open"}).appendChild(e.content.cloneNode(!0))}}function a(e){if(!e)return;if(e instanceof HTMLElement)return e;if(Array.isArray(e))return e.map((e=>a(e)));const{tag:t,text:n,html:r,children:o,attributes:i,events:l}=e;if(!t)return document.createElement("template");let s=null;return s=["svg","path"].includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t),r&&(s.innerHTML=r),(n||0===n||""===n)&&(s.innerText=n),i&&Object.keys(i).forEach((e=>{"classes"===e&&Array.isArray(i[e])?s.className=i[e].join(" "):s.setAttribute("classes"===e?"class":e,i[e])})),l&&Object.keys(l).forEach((t=>{s.addEventListener(t,l[t].bind(e))})),o&&s.append(...o.filter(Boolean).map(a)),s}document.body.innerHTML+='<template id="e-button-template">\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      color: #343434;\n      font-size: 12px;\n    }\n    .button-box {\n      /* background-color: red; */\n      padding: 4px 8px;\n      box-sizing: border-box;\n      border-width: 0px;\n      border-radius: 4px;\n      cursor: pointer;\n      background-color: rgb(3, 145, 98);\n      color: #fff;\n    }\n    .button-box:hover {\n      background-color: rgb(2, 129, 86);\n    }\n    .button-box:active {\n      background-color: rgb(1, 107, 72);\n    }\n    /* .button-box:focus {\n      outline: 2px solid rgb(94, 0, 0);\n    } */\n    .button-container {\n      color: #fff;\n    }\n  </style>\n  <button class="button-box">\n    <slot class="button-container"></slot>\n  </button>\n</template>',customElements.define("e-button",o);class i extends HTMLElement{tabs=[];activeTab="";constructor(){super(),this.attachShadow({mode:"open"}).appendChild(document.getElementById("e-tab-template").content.cloneNode(!0));const e=this.shadowRoot.querySelector(".e-tab-box"),t=[].slice.apply(e.querySelector(".e-tab-body-box").children)[0].assignedNodes();this.tabs=t.map((e=>{if(e.attributes&&e.attributes.getNamedItem("label")&&e.attributes.getNamedItem("name")){e.style.display="none";const t=e.attributes.getNamedItem("label").value,n=e.attributes.getNamedItem("name").value;return{label:t,name:n,display:getComputedStyle(e,null).display,el:e,header:a({tag:"div",text:t,attributes:{classes:["e-tab-header-item"],name:n},events:{click:e=>{this.handleClickTabHeader(e,n)}}})}}e.remove()})).filter(Boolean),this.activeTab=this.tabs[0].name,this.tabs[0].header.classList.add("e-tab-header-item-active"),this.tabs[0].el.style.display="",e.insertBefore(a({tag:"div",attributes:{classes:["e-tab-header-box"]},children:this.tabs.map((e=>e.header))}),e.firstChild)}handleClickTabHeader(e,t){const n=this.tabs.find((e=>e.name===this.activeTab));n.header.classList.remove("e-tab-header-item-active"),n.el.style.display="none",this.activeTab=t;const r=this.tabs.find((e=>e.name===this.activeTab));r.header.classList.add("e-tab-header-item-active"),r.el.style.display=""}}document.body.innerHTML+='<template id="e-tab-template">\n  <style>\n    .e-tab-box {\n      position: relative;\n      display: flex;\n      flex-flow: column;\n      align-items: stretch;\n    }\n    .e-tab-header-box {\n      display: flex;\n      flex-flow: row nowrap;\n      align-items: center;\n      width: 100%;\n    }\n    .e-tab-header-item {\n      margin-left: 4px;\n      padding: 4px 8px;\n      background-color: #aaa;\n      box-sizing: border-box;\n      border: 1px solid #999;\n      border-radius: 4px 4px 0 0;\n      cursor: pointer;\n      border-bottom-width: 0;\n      color: #fff;\n    }\n    .e-tab-header-item:first-child {\n      margin-left: 0;\n    }\n    .e-tab-header-item-active {\n      color: #343434;\n      background-color: #fff;\n    }\n    .e-tab-body-box {\n      padding: 4px 8px;\n      border: 1px solid #999;\n      border-radius: 0 0 4px 4px;\n      box-sizing: border-box;\n    }\n  </style>\n  <div class="e-tab-box">\n    <div class="e-tab-body-box">\n      <slot></slot>\n    </div>\n  </div>\n</template>',customElements.define("e-tab",i);class l extends HTMLElement{#e=null;#t=null;#n=null;constructor(){super(),this.#e=this.attachShadow({mode:"closed"}),this.#e.appendChild(document.getElementById("page-header").content.cloneNode(!0)),this.#t=this.#e.querySelector("#manuscript-logo-img"),this.#n=this.#e.querySelector("#manuscript-logo-text")}connectedCallback(){this.#t.addEventListener("click",this.#r),this.#n.addEventListener("click",this.#r)}#r(){this.dispatchEvent(new CustomEvent("click-logo",{bubbles:!1,cancelable:!1,composed:!0,detail:{data:new Date}}))}#o(){const e=window.location.href;console.log(e),/manuscript/.test(e)?window.location.assign("/manuscript"):window.location.assign("/")}}document.getElementById("page-header")||(document.body.innerHTML+='<template id="page-header">\n  <style>\n    .page-header-box {\n      --logoSize: 36px;\n\n      position: fixed;\n      width: 100vw;\n      height: 48px;\n      top: 0;\n      display: flex;\n      flex-flow: row nowrap;\n      align-items: center;\n      padding: 0 8px;\n      font-size: 12px;\n      box-sizing: border-box;\n      z-index: 9999;\n      background-color: #32343d;\n      box-sizing: border-box;\n      box-shadow: 0px 2px 5px 3px rgba(0, 0, 0, 0.2);\n      color: #ffffff;\n    }\n\n    .manuscript-logo-box {\n      display: flex;\n      flex-flow: row nowrap;\n      align-items: center;\n    }\n\n    .manuscript-logo-img {\n      width: var(--logoSize);\n      transform: rotateY(180deg);\n      border: 1px solid #343434;\n      border-radius: 50%;\n      cursor: pointer;\n      background-color: #fff;\n    }\n\n    .manuscript-logo-text {\n      text-decoration: underline;\n      font-weight: bolder;\n      transition: all .3s ease-in-out;\n      cursor: pointer;\n      margin-left: 8px;\n    }\n\n    .manuscript-logo-text:hover {\n      color: rgb(3, 145, 98);\n    }\n\n    .page-title-box {\n      margin-left: 16px;\n      font-size: 16px;\n      font-weight: bolder;\n    }\n  </style>\n  <div class="page-header-box">\n    <div class="manuscript-logo-box">\n      <img\n        id="manuscript-logo-img"\n        class="manuscript-logo-img"\n        src="/manuscript/assets/images/writing.a59d3288.png"\n        alt="tigercheng manuscript logo"\n      />\n      <div\n        id="manuscript-logo-text"\n        class="manuscript-logo-text"\n      >JavaScript Manuscript</div>\n    </div>\n    <div class="page-title-box">\n      <slot></slot>\n    </div>\n  </div>\n</template>'),customElements.define("page-header",l),window.onload=()=>{const e=document.getElementById("lambdaSourceCodeBox"),o=document.getElementById("lambdaRunResultBox"),a=document.getElementById("runBtn"),i=new n;i.def("print",(e=>{o.innerText+=e})),i.def("println",(e=>{o.innerText+=e+"\n"})),a.addEventListener("click",(()=>{if(!e.value)return;const n=function(e){let t=null;const n=["if","then","else","lambda","true","false"],r=["+","-","*","/","%","=","&","|","<",">","!"],o=[",",";","(",")","{","}","[","]"],a=[" ","\t","\n"];function i(e){return/\d/i.test(e)}function l(e){return/[_a-zA-Z]/i.test(e)}function s(e){return l(e)||/[0-9_]/.test(e)}function c(e){return r.includes(e)}function u(e){return a.includes(e)}function d(t){let n="";for(;!e.eof()&&t(e.peek());)n+=e.next();return n}function p(t){let n=!1,r="";for(e.next();!e.eof();){let o=e.next();if(n)r+=o,n=!1;else if("\\"===o)n=!0;else{if(o===t)break;r+=o}}return r}function b(){if(d(u),e.eof())return null;let t=e.peek();return"#"===t?(d((e=>"\n"!==e)),e.next(),b()):'"'===t?{type:"string",value:p('"')}:i(t)?function(){let e=!1,t=d((t=>"."===t?!e&&(e=!0,e):i(t)));return{type:"number",value:parseFloat(t)}}():l(t)?function(){let e=d(s);return{type:(t=e,n.includes(t)?"keyword":"variable"),value:e};var t}():(r=t,o.includes(r)?{type:"puctuaton",value:e.next()}:c(t)?{type:"operation",value:d(c)}:void e.croak(`Cannot handle character: ${t}`));var r}function f(){return t||(t=b())}return{next:function(){let e=t;return t=null,e||b()},peek:f,eof:function(){return null===f()},croak:e.croak}}(function(e){let t=0,n=1,r=0;function o(){return e.charAt(t)}return{next:function(){let o=e.charAt(t++);return"\n"===o?(n++,r=0):r++,o},peek:o,eof:function(){return""===o()},croak:function(e){throw new Error(`${e} (line: ${n}; col: ${r})`)}}}(e.value));console.log(n),r(t(n),i)})),window.addEventListener("keypress",(t=>{t.ctrlKey&&"Enter"===t.key&&document.activeElement===e&&a.click()}))}}();